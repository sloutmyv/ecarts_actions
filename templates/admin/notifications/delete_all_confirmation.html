{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_modify %}

{% block title %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block extrahead %}
    {{ block.super }}
    <style>
        .warning-box {
            background-color: #2d3748;
            border: 1px solid #4a5568;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            color: #f7fafc;
        }
        .danger-box {
            background-color: #742a2a;
            border: 1px solid #c53030;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            color: #fed7d7;
        }
        .stats-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        .stats-table th, .stats-table td {
            border: 1px solid #4a5568;
            padding: 8px 12px;
            text-align: left;
            color: #f7fafc;
        }
        .stats-table th {
            background-color: #1a202c;
            font-weight: bold;
        }
        .confirm-button {
            background-color: #dc3545;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin-right: 10px;
        }
        .cancel-button {
            background-color: #6c757d;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            text-decoration: none;
            display: inline-block;
        }
        .confirm-button:hover {
            background-color: #c82333;
        }
        .cancel-button:hover {
            background-color: #5a6268;
        }
    </style>
{% endblock %}

{% block content %}
<div id="content-main">
    <div class="danger-box">
        <h2>‚ö†Ô∏è ATTENTION - Action irr√©versible !</h2>
        <p><strong>Vous √™tes sur le point de supprimer TOUTES les notifications de la base de donn√©es.</strong></p>
        <p>Cette action ne peut pas √™tre annul√©e et affectera tous les utilisateurs du syst√®me.</p>
    </div>

    <div class="warning-box">
        <h3>üìä Statistiques actuelles</h3>
        <p><strong>Total des notifications : {{ total_count }}</strong></p>
        
        {% if type_stats %}
        <table class="stats-table">
            <thead>
                <tr>
                    <th>Type de notification</th>
                    <th>Nombre</th>
                </tr>
            </thead>
            <tbody>
                {% for stat in type_stats %}
                <tr>
                    <td>{{ stat.type }}</td>
                    <td><strong>{{ stat.count }}</strong></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}
    </div>

    <div class="warning-box">
        <h3>üî• Cons√©quences de cette action</h3>
        <ul>
            <li>‚ùå <strong>{{ total_count }} notifications</strong> seront d√©finitivement supprim√©es</li>
            <li>üë• Tous les utilisateurs perdront leurs notifications</li>
            <li>üìß L'historique des notifications sera perdu</li>
            <li>‚ö†Ô∏è Les notifications de validation en cours seront supprim√©es</li>
            <li>üìù Cette action sera enregistr√©e dans les logs d'administration</li>
        </ul>
    </div>

    <form method="post">
        {% csrf_token %}
        <input type="hidden" name="confirm" value="1">
        
        <h3>Pour confirmer cette suppression, tapez "SUPPRIMER TOUT" ci-dessous :</h3>
        <input type="text" id="confirmation-text" placeholder="Tapez: SUPPRIMER TOUT" 
               style="padding: 8px; font-size: 16px; width: 300px; margin: 10px 0;">
        
        <br><br>
        
        <button type="submit" class="confirm-button" id="confirm-btn" disabled>
            üóëÔ∏è CONFIRMER LA SUPPRESSION DE {{ total_count }} NOTIFICATIONS
        </button>
        
        <a href="{% url 'admin:core_notification_changelist' %}" class="cancel-button">
            ‚ùå Annuler
        </a>
    </form>

    <script>
        document.getElementById('confirmation-text').addEventListener('input', function(e) {
            const confirmBtn = document.getElementById('confirm-btn');
            if (e.target.value === 'SUPPRIMER TOUT') {
                confirmBtn.disabled = false;
                confirmBtn.style.backgroundColor = '#dc3545';
            } else {
                confirmBtn.disabled = true;
                confirmBtn.style.backgroundColor = '#6c757d';
            }
        });
        
        document.querySelector('form').addEventListener('submit', function(e) {
            const confirmText = document.getElementById('confirmation-text').value;
            if (confirmText !== 'SUPPRIMER TOUT') {
                e.preventDefault();
                alert('Vous devez taper "SUPPRIMER TOUT" pour confirmer.');
                return false;
            }
            
            return confirm('√ätes-vous ABSOLUMENT S√õR de vouloir supprimer toutes les notifications ? Cette action est IRR√âVERSIBLE !');
        });
    </script>
</div>
{% endblock %}