# EcartsActions - Guide D√©veloppeur

## üìã Table des mati√®res

- [Vue d'ensemble](#vue-densemble)
- [Architecture technique](#architecture-technique)
- [Base de donn√©es et mod√®les](#base-de-donn√©es-et-mod√®les)
- [Installation et configuration](#installation-et-configuration)
- [Structure du projet](#structure-du-projet)
- [Stack technologique](#stack-technologique)
- [Conventions de d√©veloppement](#conventions-de-d√©veloppement)
- [Workflows de d√©veloppement](#workflows-de-d√©veloppement)
- [Tests](#tests)
- [D√©ploiement](#d√©ploiement)
- [Maintenance](#maintenance)

## üéØ Vue d'ensemble

EcartsActions est une application web moderne de **gestion d'√©carts et d'actions** construite avec Django et une stack frontend moderne. L'application permet de g√©rer une structure organisationnelle hi√©rarchique avec des services/d√©partements et leurs relations, ainsi que le suivi d'√©carts et de plans d'actions.

### Fonctionnalit√©s principales
- **Gestion des Services**: Organisation hi√©rarchique des d√©partments/services
- **Gestion des Utilisateurs**: Syst√®me d'authentification personnalis√© avec 3 niveaux de droits
- **Authentification Matricule**: Connexion par matricule (format: Lettre + 4 chiffres)
- **Interface moderne**: Navigation intuitive avec dropdowns hi√©rarchiques
- **Import/Export JSON**: Sauvegarde et restauration des donn√©es organisationnelles
- **Modales de confirmation**: Syst√®me uniforme de confirmation pour les suppressions
- **Gestion des √âcarts**: Suivi et traitement des non-conformit√©s (√† venir)
- **Plans d'Actions**: Planification et suivi des actions correctives (√† venir)

### Objectifs techniques
- Interface utilisateur moderne et responsive
- Interactions fluides sans rechargement de page (HTMX)
- Composants r√©actifs c√¥t√© client (Alpine.js)
- Modales pour les formulaires de cr√©ation/modification
- Modales de confirmation centr√©es avec design uniforme
- Actions align√©es visuellement avec ic√¥nes intuitives

### Philosophie technique
- **Progressive Enhancement**: L'application fonctionne sans JavaScript et s'am√©liore avec
- **HTMX-first**: Privil√©gier HTMX pour les interactions AJAX
- **Tailwind CSS**: Classes utilitaires pour un styling coh√©rent
- **Alpine.js**: R√©activit√© l√©g√®re c√¥t√© client quand n√©cessaire

## üèóÔ∏è Architecture technique

### Architecture g√©n√©rale
```
Frontend (Browser)
‚îú‚îÄ‚îÄ Tailwind CSS (Styling)
‚îú‚îÄ‚îÄ HTMX (AJAX Interactions)
‚îî‚îÄ‚îÄ Alpine.js (Client Reactivity)
        ‚Üï
Backend (Django)
‚îú‚îÄ‚îÄ Views (Business Logic)
‚îú‚îÄ‚îÄ Models (Data Layer)
‚îú‚îÄ‚îÄ Templates (HTML Generation)
‚îî‚îÄ‚îÄ Static Files (Assets)
        ‚Üï
Database (SQLite)
‚îú‚îÄ‚îÄ Service (Hierarchical Organization)
‚îî‚îÄ‚îÄ User (Custom Authentication Model)
```

## üóÉÔ∏è Base de donn√©es et mod√®les

### Structure de la base de donn√©es

L'application utilise **SQLite** en d√©veloppement avec une structure simple mais puissante pour g√©rer l'organisation hi√©rarchique et l'authentification personnalis√©e.

### Mod√®le User (Authentification personnalis√©e)

Le mod√®le `User` utilise l'authentification par matricule avec 3 niveaux de droits.

```python
class User(AbstractBaseUser, PermissionsMixin, TimestampedModel):
    # Matricule unique (Lettre + 4 chiffres)
    matricule = models.CharField(max_length=5, unique=True)
    nom = models.CharField(max_length=50)
    prenom = models.CharField(max_length=50)
    email = models.EmailField(blank=True)
    
    # Niveaux de droits
    SUPER_ADMIN = 'SA'  # Acc√®s complet + Admin Django
    ADMIN = 'AD'        # Acc√®s administratif (sans Admin Django)
    USER = 'US'         # Utilisateur standard
    
    droits = models.CharField(max_length=2, choices=DROITS_CHOICES, default=USER)
    service = models.ForeignKey(Service, null=True, blank=True)
    must_change_password = models.BooleanField(default=True)
```

#### Syst√®me d'authentification
- **Matricule**: Format requis `[A-Z][0-9]{4}` (ex: A1234)
- **Mot de passe par d√©faut**: `azerty` (changement obligatoire √† la premi√®re connexion)
- **Interface d√©di√©e**: Templates de connexion et changement de mot de passe personnalis√©s
- **Middleware**: Force le changement de mot de passe si n√©cessaire

#### Niveaux de droits et acc√®s
| Niveau | Code | Acc√®s Navigation | Acc√®s Administration | Admin Django |
|--------|------|------------------|---------------------|--------------|
| Super Administrateur | `SA` | ‚úÖ Tous menus | ‚úÖ Services + Utilisateurs | ‚úÖ Oui |
| Administrateur | `AD` | ‚úÖ Tous menus | ‚úÖ Services + Utilisateurs | ‚ùå Non |
| Utilisateur | `US` | ‚úÖ Dashboard, √âcarts, Actions | ‚ùå Aucun | ‚ùå Non |

### Mod√®le Service

Le mod√®le `Service` est le c≈ìur de l'application, permettant de cr√©er une structure organisationnelle compl√®te.

```python
class Service(models.Model):
    nom = models.CharField(max_length=100)
    code = models.CharField(max_length=20, unique=True)
    parent = models.ForeignKey('self', null=True, blank=True, 
                              related_name='sous_services')
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
```

#### Champs du mod√®le Service

| Champ | Type | Description | Contraintes |
|-------|------|-------------|-------------|
| `nom` | CharField(100) | Nom du service/d√©partement | Obligatoire |
| `code` | CharField(20) | Code unique d'identification | Unique, obligatoire |
| `parent` | ForeignKey(self) | Service parent dans la hi√©rarchie | Optionnel |
| `created_at` | DateTimeField | Date de cr√©ation automatique | Auto-g√©n√©r√© |
| `updated_at` | DateTimeField | Date de modification automatique | Auto-g√©n√©r√© |

#### Relations hi√©rarchiques

```
Direction G√©n√©rale (DG)
‚îú‚îÄ‚îÄ Direction des Ressources Humaines (DRH)
‚îÇ   ‚îú‚îÄ‚îÄ Service Recrutement (REC)
‚îÇ   ‚îî‚îÄ‚îÄ Service Formation (FORM)
‚îú‚îÄ‚îÄ Direction Financi√®re (DF)
‚îÇ   ‚îú‚îÄ‚îÄ Comptabilit√© (COMPTA)
‚îÇ   ‚îî‚îÄ‚îÄ Contr√¥le de Gestion (CG)
‚îî‚îÄ‚îÄ Direction Technique (DT)
    ‚îú‚îÄ‚îÄ Bureau d'√âtudes (BE)
    ‚îî‚îÄ‚îÄ Service Maintenance (MAINT)
```

#### M√©thodes du mod√®le Service

| M√©thode | Description | Retour |
|---------|-------------|--------|
| `get_niveau()` | Calcule le niveau hi√©rarchique | `int` (0 = racine) |
| `get_chemin_hierarchique()` | Chemin complet depuis la racine | `str` ("DG > DRH > REC") |
| `get_descendants()` | Tous les sous-services r√©cursivement | `QuerySet` |
| `is_racine()` | V√©rifie si c'est un service racine | `bool` |
| `clean()` | Validation des d√©pendances circulaires | `None` |

### Validations et contraintes

#### Validation des d√©pendances circulaires
```python
def clean(self):
    if self.parent and self.parent == self:
        raise ValidationError("Un service ne peut pas √™tre son propre parent.")
    
    if self.parent and self._check_circular_dependency(self.parent):
        raise ValidationError("Cette relation cr√©erait une d√©pendance circulaire.")
```

#### Exemples de d√©pendances interdites
- ‚ùå `Service A` ‚Üí parent : `Service A` (auto-r√©f√©rence)
- ‚ùå `Service A` ‚Üí `Service B` ‚Üí `Service A` (cycle)
- ‚úÖ `Service A` ‚Üí `Service B` ‚Üí `Service C` (hi√©rarchie valide)

### Interactions avec la base de donn√©es

#### Op√©rations CRUD

**Cr√©ation d'un service**
```python
# Cr√©ation d'un service racine
service_dg = Service.objects.create(
    nom="Direction G√©n√©rale",
    code="DG"
)

# Cr√©ation d'un sous-service
service_drh = Service.objects.create(
    nom="Direction des Ressources Humaines",
    code="DRH",
    parent=service_dg  # R√©f√©rence au service parent
)
```

**Requ√™tes hi√©rarchiques**
```python
# R√©cup√©rer tous les services racines
services_racines = Service.objects.filter(parent=None)

# R√©cup√©rer tous les sous-services d'un service
sous_services = service_dg.sous_services.all()

# Recherche par niveau hi√©rarchique
services_niveau_2 = Service.objects.filter(
    parent__parent__isnull=False,
    parent__isnull=False
)
```

#### Import/Export JSON

**Format d'export**
```json
{
  "model": "Service",
  "export_date": "2024-01-28T10:30:00",
  "total_records": 5,
  "data": [
    {
      "id": 1,
      "nom": "Direction G√©n√©rale",
      "code": "DG",
      "parent_id": null,
      "parent_code": null,
      "created_at": "2024-01-28T08:00:00",
      "updated_at": "2024-01-28T08:00:00"
    },
    {
      "id": 2,
      "nom": "Direction des Ressources Humaines",
      "code": "DRH",
      "parent_id": 1,
      "parent_code": "DG",
      "created_at": "2024-01-28T08:15:00",
      "updated_at": "2024-01-28T08:15:00"
    }
  ]
}
```

**Processus d'import**
1. **Validation du fichier** : Format JSON, structure attendue
2. **Tri hi√©rarchique** : Parents trait√©s avant les enfants
3. **R√©solution des conflits** : Mise √† jour ou cr√©ation selon le code
4. **Transaction atomique** : Rollback en cas d'erreur
5. **Rapport d'import** : Statistiques de cr√©ation/mise √† jour

### Optimisations de performance

#### Requ√™tes optimis√©es
```python
# √âviter N+1 queries avec select_related
services = Service.objects.select_related('parent')

# Pr√©charger les sous-services
services = Service.objects.prefetch_related('sous_services')

# Requ√™te compl√®te optimis√©e
services = Service.objects.select_related('parent').prefetch_related('sous_services')
```

#### Index de base de donn√©es
- Index automatique sur `id` (cl√© primaire)
- Index automatique sur `code` (contrainte unique)
- Index automatique sur `parent_id` (cl√© √©trang√®re)

### Migration et √©volution du sch√©ma

#### Migrations Django appliqu√©es
```bash
# Migration initiale (cr√©ation du mod√®le Service)
0001_initial.py

# Suppression du mod√®le Item (ancien mod√®le)
0002_delete_item.py

# Ajout des contraintes de validation
0003_add_service_constraints.py
```

#### Commandes utiles
```bash
# V√©rifier les migrations en attente
python manage.py showmigrations

# Cr√©er une nouvelle migration
python manage.py makemigrations

# Appliquer les migrations
python manage.py migrate

# Rollback vers une migration pr√©c√©dente
python manage.py migrate core 0001
```

### Patterns d'architecture utilis√©s
- **MVT (Model-View-Template)**: Pattern Django standard
- **HTMX Patterns**: 
  - Swap HTML partials
  - Trigger events for updates
  - Progressive enhancement
- **Component-based Templates**: Templates modulaires et r√©utilisables

## ‚öôÔ∏è Installation et configuration

### Pr√©requis
- Python 3.12.3+
- Git
- Virtual environment (venv)

### Installation locale

1. **Cloner le repository**
```bash
git clone <repository-url>
cd ecarts_actions
```

2. **Configurer l'environnement virtuel**
```bash
# L'environnement virtuel existe d√©j√†
source venv/bin/activate

# Installer les d√©pendances
pip install -r requirements.txt
```

3. **Configuration de la base de donn√©es**
```bash
python manage.py migrate
python manage.py createsuperuser  # Optionnel
```

4. **Lancer le serveur de d√©veloppement**
```bash
python manage.py runserver
```

5. **Acc√©der √† l'application**
- Application: http://127.0.0.1:8000/
- Admin Django: http://127.0.0.1:8000/admin/

### Variables d'environnement

Cr√©er un fichier `.env` (optionnel pour le d√©veloppement):
```bash
DEBUG=True
SECRET_KEY=your-secret-key
DATABASE_URL=sqlite:///db.sqlite3
```

## üìÅ Structure du projet

### Architecture modulaire par domaine m√©tier

```
ecarts_actions/
‚îú‚îÄ‚îÄ üìÅ ecarts_actions/          # Configuration Django
‚îÇ   ‚îú‚îÄ‚îÄ settings.py            # ‚öôÔ∏è Configuration principale
‚îÇ   ‚îú‚îÄ‚îÄ urls.py               # üîó URLs racine
‚îÇ   ‚îú‚îÄ‚îÄ wsgi.py               # üöÄ Configuration WSGI
‚îÇ   ‚îî‚îÄ‚îÄ asgi.py               # üöÄ Configuration ASGI
‚îú‚îÄ‚îÄ üìÅ core/                   # üéØ Application principale
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ models/             # üóÉÔ∏è Mod√®les par domaine
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py       # üì¶ Import centralis√©
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py           # üèóÔ∏è Mod√®les abstraits (TimestampedModel, CodedModel)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services.py       # üè¢ Mod√®le Service (organisation hi√©rarchique)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ users.py          # üë§ Mod√®le User (authentification personnalis√©e)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ecarts.py         # ‚ö†Ô∏è Mod√®les √âcart, TypeEcart (√† venir)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ actions.py        # üìã Mod√®les Action, PlanAction (√† venir)
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ views/              # üëÅÔ∏è Vues par domaine
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py       # üì¶ Import centralis√©
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboard.py      # üìä Vue tableau de bord
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services.py       # üè¢ CRUD services + import/export
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ users.py          # üë§ CRUD utilisateurs + gestion droits
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.py           # üîê Authentification personnalis√©e
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ecarts.py         # ‚ö†Ô∏è Gestion des √©carts (√† venir)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ actions.py        # üìã Gestion des plans d'actions (√† venir)
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ admin/              # üîß Configuration admin par domaine
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py       # üì¶ Import centralis√©
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services.py       # üè¢ ServiceAdmin
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ users.py          # üë§ UserAdmin
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ecarts.py         # ‚ö†Ô∏è EcartAdmin (√† venir)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ actions.py        # üìã ActionAdmin (√† venir)
‚îÇ   ‚îú‚îÄ‚îÄ urls.py               # üîó URLs de l'app
‚îÇ   ‚îî‚îÄ‚îÄ migrations/           # üì¶ Migrations DB
‚îú‚îÄ‚îÄ üìÅ templates/              # üé® Templates par domaine
‚îÇ   ‚îú‚îÄ‚îÄ base.html             # üè† Template de base avec Tailwind/HTMX/Alpine
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ admin/              # üîß Templates admin personnalis√©s
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ core/service/     # üè¢ Templates import/export services
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ core/               # üìÅ Templates de l'app core
‚îÇ       ‚îú‚îÄ‚îÄ üìÅ dashboard/      # üìä Templates tableau de bord
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ dashboard.html # üìä Page principale dashboard
‚îÇ       ‚îú‚îÄ‚îÄ üìÅ auth/           # üîê Templates authentification
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ login.html    # üîë Page de connexion personnalis√©e
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ change_password.html # üîí Changement mot de passe
‚îÇ       ‚îú‚îÄ‚îÄ üìÅ services/       # üè¢ Templates gestion services
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ list.html     # üìã Liste hi√©rarchique des services
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ item.html     # üìÑ Item service (r√©cursif)
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ detail.html   # üîç D√©tail d'un service
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ form.html     # üìù Formulaire service
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ form_modal.html # üìù Formulaire modal HTMX
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ notification_confirm.html # ‚ö†Ô∏è Modale confirmation suppression
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ notification_warning.html # ‚ö†Ô∏è Modale warning suppression
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ notification_error.html   # ‚ùå Modale erreur suppression
‚îÇ       ‚îú‚îÄ‚îÄ üìÅ users/          # üë§ Templates gestion utilisateurs
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ list.html     # üìã Liste des utilisateurs
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ item.html     # üìÑ Item utilisateur
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ detail.html   # üîç D√©tail d'un utilisateur
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ form.html     # üìù Formulaire utilisateur
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ form_modal.html # üìù Formulaire modal HTMX
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ notification_confirm.html # ‚ö†Ô∏è Modale confirmation suppression
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ notification_warning.html # ‚ö†Ô∏è Modale warning suppression
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ notification_error.html   # ‚ùå Modale erreur suppression
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ icons.html    # üé® Ic√¥nes utilisateurs
‚îÇ       ‚îú‚îÄ‚îÄ üìÅ ecarts/         # ‚ö†Ô∏è Templates gestion √©carts (√† venir)
‚îÇ       ‚îî‚îÄ‚îÄ üìÅ actions/        # üìã Templates gestion actions (√† venir)
‚îú‚îÄ‚îÄ üìÅ static/                 # üé≠ Fichiers statiques
‚îÇ   ‚îú‚îÄ‚îÄ css/                  # üé® CSS personnalis√©s
‚îÇ   ‚îú‚îÄ‚îÄ js/                   # ‚ö° JavaScript personnalis√©s
‚îÇ   ‚îî‚îÄ‚îÄ images/               # üñºÔ∏è Images
‚îú‚îÄ‚îÄ üìÅ venv/                   # üêç Environnement virtuel Python 3.12.3
‚îú‚îÄ‚îÄ manage.py                 # üõ†Ô∏è CLI Django
‚îú‚îÄ‚îÄ requirements.txt          # üì¶ D√©pendances Python
‚îú‚îÄ‚îÄ README.md                 # üìñ Documentation d√©veloppeur
‚îú‚îÄ‚îÄ MANUEL.md                 # üìã Manuel utilisateur
‚îî‚îÄ‚îÄ CLAUDE.md                 # ü§ñ Guide Claude Code
```

### Principe de l'architecture modulaire

#### üèóÔ∏è Organisation par domaine m√©tier
Chaque domaine m√©tier (services, √©carts, actions) est organis√© dans sa propre structure :
- **Mod√®les** : `models/domaine.py` - Logique de donn√©es
- **Vues** : `views/domaine.py` - Logique m√©tier et interaction
- **Admin** : `admin/domaine.py` - Configuration interface d'administration
- **Templates** : `templates/core/domaine/` - Interface utilisateur

#### üì¶ Import centralis√©
Les fichiers `__init__.py` permettent d'importer tous les composants d'un domaine :
```python
# core/models/__init__.py
from .services import Service
from .ecarts import Ecart, TypeEcart  # √Ä venir
from .actions import Action, PlanAction  # √Ä venir

# core/views/__init__.py
from .dashboard import dashboard
from .services import services_list, service_create, service_edit
```

#### üîÑ √âvolutivit√© et maintenance
- **Ajout facile** de nouveaux domaines m√©tier
- **S√©paration claire** des responsabilit√©s
- **Tests isol√©s** par domaine
- **R√©utilisabilit√©** des composants de base
- **Collaboration** facilit√©e (plusieurs d√©veloppeurs)

## üõ†Ô∏è Stack technologique

### Backend
- **Django 5.2.4**: Framework web Python
- **SQLite**: Base de donn√©es (d√©veloppement)
- **Django Compressor**: Compression des assets statiques

### Frontend
- **Tailwind CSS**: Framework CSS utility-first
- **HTMX 1.9.10**: Interactions AJAX sans JavaScript complexe
- **Alpine.js 3.x**: R√©activit√© c√¥t√© client l√©g√®re

### Outils de d√©veloppement
- **Python 3.12.3**: Langage de programmation
- **Git**: Contr√¥le de version
- **VS Code**: IDE recommand√©

## üìè Conventions de d√©veloppement

### Architecture modulaire par domaine

#### üóÇÔ∏è Organisation des fichiers
Suivre la structure modulaire pour tous les nouveaux domaines m√©tier :

```python
# ‚úÖ Correct : Organisation par domaine
core/
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py          # Import centralis√©
‚îÇ   ‚îú‚îÄ‚îÄ base.py              # Mod√®les abstraits r√©utilisables
‚îÇ   ‚îú‚îÄ‚îÄ services.py          # Domaine services
‚îÇ   ‚îú‚îÄ‚îÄ ecarts.py            # Domaine √©carts
‚îÇ   ‚îî‚îÄ‚îÄ actions.py           # Domaine actions
‚îú‚îÄ‚îÄ views/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py          # Import centralis√©
‚îÇ   ‚îú‚îÄ‚îÄ dashboard.py         # Vue transversale
‚îÇ   ‚îú‚îÄ‚îÄ services.py          # Vues domaine services
‚îÇ   ‚îú‚îÄ‚îÄ ecarts.py            # Vues domaine √©carts
‚îÇ   ‚îî‚îÄ‚îÄ actions.py           # Vues domaine actions
```

#### üì¶ R√®gles d'import centralis√©
Chaque module doit exposer ses composants via `__init__.py` :

```python
# core/models/__init__.py
from .services import Service
from .ecarts import Ecart, TypeEcart, StatutEcart
from .actions import Action, PlanAction, Responsable

# Permet d'importer simplement :
from core.models import Service, Ecart, Action
```

#### üèóÔ∏è Mod√®les de base
Utiliser les mod√®les abstraits pour la coh√©rence :

```python
# Utiliser les mod√®les de base
from .base import TimestampedModel, CodedModel

class NouveauModele(TimestampedModel, CodedModel):
    nom = models.CharField(max_length=100)
    # H√©rite automatiquement de : created_at, updated_at, code
```

### Conventions Python/Django
- **PEP 8**: Style guide Python standard
- **Django Conventions**: Nommage des mod√®les, vues, URLs
- **Docstrings**: Documentation des fonctions et classes avec format Google/NumPy
- **Type Hints**: Utiliser les annotations de type quand c'est pertinent

### Conventions Frontend
- **Tailwind Classes**: Utiliser les classes Tailwind plut√¥t que du CSS custom
- **HTMX Attributes**: Pr√©fixer avec `hx-` et documenter les interactions
- **Alpine.js**: Utiliser `x-data`, `x-show`, etc. avec parcimonie

### Conventions de nommage par domaine
```python
# Mod√®les : PascalCase avec pr√©fixe domaine si n√©cessaire
class Service(models.Model):          # ‚úÖ Simple et clair
class EcartQualite(models.Model):     # ‚úÖ Pr√©fixe si ambigu
class Action(models.Model):           # ‚úÖ Simple et clair

# Vues : snake_case avec pr√©fixe domaine
def services_list(request):           # ‚úÖ services_list
def service_create(request):          # ‚úÖ service_create
def ecart_validate(request):          # ‚úÖ ecart_validate

# URLs : kebab-case avec pr√©fixe domaine
path('services/', views.services_list, name='services-list')
path('services/create/', views.service_create, name='service-create')
path('ecarts/validate/<int:pk>/', views.ecart_validate, name='ecart-validate')

# Templates : Organisation par dossier domaine
templates/core/services/list.html     # ‚úÖ Organis√© par domaine
templates/core/services/form.html     # ‚úÖ Nom explicite
templates/core/ecarts/detail.html     # ‚úÖ Coh√©rent
```

### Structure des fichiers par domaine

#### üìù Template d'un nouveau domaine
```python
# core/models/nouveau_domaine.py
"""
Mod√®les li√©s au domaine [Nom du domaine].
Description du domaine et de ses responsabilit√©s.
"""
from django.db import models
from .base import TimestampedModel, CodedModel

class NouveauModele(TimestampedModel, CodedModel):
    """Documentation du mod√®le."""
    nom = models.CharField(max_length=100, verbose_name="Nom")
    
    class Meta:
        verbose_name = "N. Nouveau Mod√®le"  # N = ordre d'affichage
        verbose_name_plural = "N. Nouveaux Mod√®les"
        
    def __str__(self):
        return f"{self.code} - {self.nom}"
```

```python
# core/views/nouveau_domaine.py
"""
Vues pour la gestion du domaine [Nom du domaine].
"""
from django.shortcuts import render, get_object_or_404
from ..models import NouveauModele

def nouveau_domaine_list(request):
    """Vue liste du domaine."""
    items = NouveauModele.objects.all()
    return render(request, 'core/nouveau_domaine/list.html', {
        'items': items
    })
```

#### üóÇÔ∏è Organisation des templates
```
templates/core/nouveau_domaine/
‚îú‚îÄ‚îÄ list.html           # Liste des √©l√©ments
‚îú‚îÄ‚îÄ detail.html         # D√©tail d'un √©l√©ment
‚îú‚îÄ‚îÄ form.html           # Formulaire standard
‚îú‚îÄ‚îÄ form_modal.html     # Formulaire modal HTMX
‚îî‚îÄ‚îÄ item.html           # Item dans une liste (si r√©cursif)
```

### Structure des commits
```
type(scope): description

feat(core): add item creation functionality
fix(ui): correct modal closing behavior
docs(readme): update installation instructions
style(css): improve button styling
refactor(views): simplify item_create logic
test(core): add item model tests
```

## üîÑ Workflows de d√©veloppement

### Workflow Git
1. **Cr√©er une branche feature**
   ```bash
   git checkout -b feature/nom-de-la-feature
   ```

2. **D√©velopper la fonctionnalit√©**
   - Faire des commits atomiques
   - Mettre √† jour README.md et MANUEL.md si n√©cessaire

3. **Avant chaque commit**
   ```bash
   # V√©rifier les migrations
   python manage.py makemigrations --dry-run
   
   # V√©rifier que les tests passent
   python manage.py test
   
   # Mettre √† jour la documentation
   # - README.md (si changements techniques)
   # - MANUEL.md (si changements fonctionnels)
   ```

4. **Push et Pull Request**
   ```bash
   git push origin feature/nom-de-la-feature
   # Cr√©er une PR sur GitHub/GitLab
   ```

### D√©veloppement avec HTMX

#### Pattern de base HTMX
```html
<!-- Bouton qui d√©clenche une requ√™te HTMX -->
<button 
    hx-get="/items/create/"
    hx-target="#modal-container"
    class="btn-primary">
    Cr√©er un √©l√©ment
</button>

<!-- Container qui recevra la r√©ponse -->
<div id="modal-container"></div>
```

#### Pattern de formulaire modal
```python
# Vue qui retourne soit le formulaire soit la r√©ponse
def item_create(request):
    if request.method == 'POST':
        form = ItemForm(request.POST)
        if form.is_valid():
            item = form.save()
            # Retourner HTML partial pour mise √† jour
            html = render_to_string('core/item_row.html', {'item': item})
            response = HttpResponse(html)
            response['HX-Trigger'] = 'itemCreated'  # D√©clencher un √©v√©nement
            return response
    else:
        form = ItemForm()
    return render(request, 'core/item_form_modal.html', {'form': form})
```

### D√©veloppement avec Alpine.js

#### Pattern de base Alpine.js
```html
<div x-data="{ open: false }">
    <button @click="open = !open">Toggle</button>
    <div x-show="open">Contenu conditionnel</div>
</div>
```

## üß™ Tests

### Lancer les tests
```bash
# Tous les tests
python manage.py test

# Tests d'une app sp√©cifique
python manage.py test core

# Tests avec couverture
pip install coverage
coverage run --source='.' manage.py test
coverage report
coverage html  # G√©n√®re un rapport HTML
```

### Structure des tests
```python
# core/tests.py
from django.test import TestCase, Client
from django.urls import reverse
from .models import Item

class ItemModelTest(TestCase):
    def test_item_creation(self):
        item = Item.objects.create(title="Test Item")
        self.assertEqual(item.title, "Test Item")

class ItemViewTest(TestCase):
    def setUp(self):
        self.client = Client()
    
    def test_item_list_view(self):
        response = self.client.get(reverse('item-list'))
        self.assertEqual(response.status_code, 200)
```

## üöÄ D√©ploiement

### Pr√©paration pour la production
1. **Variables d'environnement**
   ```bash
   DEBUG=False
   SECRET_KEY=production-secret-key
   DATABASE_URL=postgresql://user:pass@localhost/dbname
   ALLOWED_HOSTS=yourdomain.com
   ```

2. **Collecte des fichiers statiques**
   ```bash
   python manage.py collectstatic
   ```

3. **Migrations**
   ```bash
   python manage.py migrate
   ```

### Configuration serveur web
- **Nginx**: Configuration pour servir les fichiers statiques
- **Gunicorn**: Serveur WSGI pour Django
- **PostgreSQL**: Base de donn√©es de production

## üîß Maintenance

### Mise √† jour des d√©pendances
```bash
# V√©rifier les d√©pendances obsol√®tes
pip list --outdated

# Mettre √† jour une d√©pendance
pip install --upgrade django

# Mettre √† jour requirements.txt
pip freeze > requirements.txt
```

### Sauvegarde de la base de donn√©es
```bash
# Export
python manage.py dumpdata > backup.json

# Import
python manage.py loaddata backup.json
```

### Monitoring et logs
- **Django Debug Toolbar**: Outil de debug en d√©veloppement
- **Logging**: Configuration dans settings.py
- **Sentry**: Monitoring des erreurs en production (optionnel)

## üìö Ressources et documentation

### Documentation officielle
- [Django Documentation](https://docs.djangoproject.com/)
- [HTMX Documentation](https://htmx.org/docs/)
- [Alpine.js Documentation](https://alpinejs.dev/)
- [Tailwind CSS Documentation](https://tailwindcss.com/docs)

### Guides et tutoriels
- [Django Best Practices](https://django-best-practices.readthedocs.io/)
- [HTMX + Django Guide](https://htmx.org/essays/django-and-htmx/)
- [Tailwind + Django Setup](https://django-tailwind.readthedocs.io/)

---

**üìù Note importante**: Ce README.md doit √™tre mis √† jour avant chaque commit qui introduit des changements techniques, architecturaux ou de configuration.